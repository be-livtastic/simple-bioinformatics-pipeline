#!/usr/bin/env Rscript

# ============================================================
# Script: Mean Gene Expression Calculation
# Purpose: 
#   - Load expression data
#   - Calculate mean expression per gene
#   - Save results to an output directory

# ============================================================

# ---- Load required libraries ----
library(tidyverse)


# Calculate mean expression for each gene
calculate_mean_expression <- function(expression_data) {
  # Assumes rows = genes, columns = samples
  rowMeans(expression_data)
}

# Save results to file
save_mean_expression <- function(mean_expression, outdir) {
  output_file <- file.path(outdir, "mean_expression.csv")
  
  results <- data.frame(
    gene = names(mean_expression),
    mean_expression = mean_expression
  )
  
  write.csv(results, output_file, row.names = FALSE)
}

# ---- Main pipeline logic ----

# Read command-line arguments
args <- commandArgs(trailingOnly = TRUE)
check_args(args)

# Output directory provided by user
outdir <- args[1]

# Load data
expression_data <- load_expression_data(outdir)

# Perform calculation
mean_expression <- calculate_mean_expression(expression_data)

# Save results
save_mean_expression(mean_expression, outdir)

